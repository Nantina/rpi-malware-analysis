from flask import Flask, request, jsonify
import random

app = Flask(__name__)

# In-memory storage for users and tasks
users = {}
tasks = []

# User Registration and Login
@app.route('/register', methods=['POST'])
def register():
    username = request.json.get('username')
    password = request.json.get('password')
    
    if username in users:
        return jsonify({'message': 'Username already exists!'}), 400
    
    users[username] = password
    return jsonify({'message': 'User registered successfully!'}), 201

@app.route('/login', methods=['POST'])
def login():
    username = request.json.get('username')
    password = request.json.get('password')
    
    if username not in users or users[username] != password:
        return jsonify({'message': 'Invalid username or password!'}), 401
    
    return jsonify({'message': f'Welcome, {username}!'}), 200

# Simple Calculator
@app.route('/calculator')
def calculator():
    operation = request.args.get('operation', 'add')
    num1 = float(request.args.get('num1', 0))
    num2 = float(request.args.get('num2', 0))

    if operation == 'add':
        result = num1 + num2
    elif operation == 'subtract':
        result = num1 - num2
    elif operation == 'multiply':
        result = num1 * num2
    elif operation == 'divide':
        result = num1 / num2 if num2 != 0 else 'Infinity'
    else:
        return 'Invalid Operation'

    return f'The result of {operation}ing {num1} and {num2} is: {result}'

# Simple To-Do List
@app.route('/add_task', methods=['POST'])
def add_task():
    task = request.json.get('task')
    if task:
        tasks.append(task)
        return jsonify({'message': 'Task added!', 'tasks': tasks}), 201
    return jsonify({'message': 'No task provided!'}), 400

@app.route('/tasks', methods=['GET'])
def get_tasks():
    return jsonify({'tasks': tasks})

if __name__ == '__main__':
    app.run(debug=True)
